# Quick Start: Testing with PostgreSQL

## Quick Setup (3 steps)

### 1. Install PostgreSQL
```bash
# macOS
brew install postgresql@15
brew services start postgresql@15

# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
```

### 2. Run the Setup Script
```bash
./setup_postgres_test.sh
```
This will:
- Create database and user
- Generate `.env.postgres` file
- Test the connection

### 3. Load Config and Migrate
```bash
# Load PostgreSQL configuration
export $(cat .env.postgres | xargs)

# Run migrations
python manage.py migrate

# Start server
python manage.py runserver
```

---

## Manual Setup (if you prefer)

### Create Database
```sql
psql postgres
CREATE USER toyota_user WITH PASSWORD 'your_password';
CREATE DATABASE toyota_training_test OWNER toyota_user;
GRANT ALL PRIVILEGES ON DATABASE toyota_training_test TO toyota_user;
\q
```

### Set Environment Variables
```bash
export DB_NAME=toyota_training_test
export DB_USER=toyota_user
export DB_PASSWORD=your_password
export DB_HOST=localhost
export DB_PORT=5432
```

### Test Connection
```bash
python test_postgres_connection.py
```

### Migrate
```bash
python manage.py migrate
```

---

## Switching Between Databases

### Use PostgreSQL
```bash
export $(cat .env.postgres | xargs)
python manage.py runserver
```

### Use SQLite (default)
```bash
unset DB_NAME DB_USER DB_PASSWORD DB_HOST DB_PORT
python manage.py runserver
```

---

## Verify Which Database is Active

```bash
python manage.py dbshell
```

- PostgreSQL: Opens `psql` prompt with `toyota_training_test=#`
- SQLite: Opens `sqlite3` prompt with `sqlite>`

---

## Common Commands

```bash
# Test connection
python test_postgres_connection.py

# Check database status
psql postgres -c "\l"

# View tables
psql toyota_training_test -c "\dt"

# Connect to database
psql toyota_training_test

# Reset database
psql postgres -c "DROP DATABASE toyota_training_test;"
psql postgres -c "CREATE DATABASE toyota_training_test OWNER toyota_user;"
python manage.py migrate
```

---

## Troubleshooting

| Problem | Solution |
|---------|----------|
| "psql: command not found" | Install PostgreSQL |
| "could not connect to server" | Start PostgreSQL: `brew services start postgresql@15` |
| "database does not exist" | Run setup script or create manually |
| "password authentication failed" | Check `DB_PASSWORD` in environment variables |
| Django uses SQLite | Environment variables not set. Run: `export $(cat .env.postgres | xargs)` |

---

## Testing Checklist

Before deploying to production:

- [x] Install PostgreSQL locally
- [x] Run setup script
- [x] Test connection with `test_postgres_connection.py`
- [x] Run migrations successfully
- [ ] Create test data
- [ ] Test all CRUD operations
- [ ] Test file uploads
- [ ] Test user authentication
- [ ] Run test suite: `python manage.py test`
- [ ] Test with production-like data volume

---

## Files Added

- `POSTGRESQL_TESTING_GUIDE.md` - Comprehensive testing guide
- `QUICK_START_POSTGRES.md` - This quick reference
- `test_postgres_connection.py` - Connection testing script
- `setup_postgres_test.sh` - Automated setup script
- `.env.postgres` - Generated by setup script (not in git)

## Files Modified

- `requirements.txt` - Added `psycopg2-binary==2.9.9`
- `toyota_training/settings.py` - Added PostgreSQL support
- `toyota_training/settings_production.py` - Updated for PostgreSQL

---

## Need More Help?

📖 See detailed guide: `POSTGRESQL_TESTING_GUIDE.md`

🐛 Run diagnostics: `python test_postgres_connection.py`

💬 Check Django database config:
```python
python manage.py shell
>>> from django.conf import settings
>>> print(settings.DATABASES)
```

